<!doctype html>
<html>
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:image" content="http://dmarchal.space/challengeMEL2021/widgets/santes-preview.png" />
  <meta property="og:url"content="http://dmarchal.space/challengeMEL2021/widgets/santes.html" />
  <meta property="og:title" content="Participation ville de Santes au challenge vélo 2021." />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@damienmarchal">
  <meta name="twitter:creator" content="@damienmarchal">
  <meta name="twitter:title" content="Participation de Santes au challenge vélo 2021.">
  <meta name="twitter:description" content="Toutes les stats des différentes éditions du Challenge Métropolitain du vélo #CMV.">
  <meta name="twitter:image" content="http://dmarchal.space/challengeMEL2021/widgets/santes-preview.png">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"  integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
</head>
<body>

  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha384-/LjQZzcpTzaYn7qWqRIWYC5l8FWEZ2bIHIz0D73Uzba4pShEcdLdZyZkI4Kv676E" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

  <div class="container-fluid rounded text-white" style="background-color:#2e97bd">
    <div class="row bg-dark" >
      <div class="col-1  mt-2" >
        <img src="./santes-blason.png" width="32"></img>
      </div>
      <div class="col-10 text-center mt-2">
        <h4>
          Participation de Santes à la 4ème édition du challenge métropolitain du vélo.
        </h4>
      </div>
    </div>
    <hr/>

    <div class="row text-center">
      <div class="col-sm">
        <div class="spinner-border ml-auto" role="status" aria-hidden="true" id="spinner"></div>
      </div>
    </div>

    <div id="line1" class="row text-center d-none mb-n1">
      <div class="col-sm">
        <h4>
          <span id="totalKm-lille">...</span> Km
        </h4>
        <h6>
          (sur <span id="totalKm">...</span>)
        </h6>

      </div>
      <div class="col-sm">

        <h4>
          <span id="numberOfMembers-lille">...</span> participants
        </h4>
        <h6>
          (sur <span id="numberOfMembers">...</span>)
        </h6>

      </div>
      <div class="col-sm">

        <h4>
          <span id="numberOfTeams-lille">...</span> équipes
        </h4>
        <h6 class="mx-auto">
          (sur <span id="numberOfTeams">...</span>)
        </h6>
      </div>
    </div>
    <hr/>

    <div class="row text-center bg-dark">
      <div class="col-sm">
        Nos équipes:
      </div>
    </div>

    <div id="line2" class="row">
      <div class="col-sm">
        <ul><li> roule pour santes: <i><span id="rps">... inscrits, ... Km</span></i> </li></ul>
      </div>
      <div class="col-sm">
        <ul><li> Santes, ma ville: <i><span id="smv">... inscrits, ... Km</span></i> </li></ul>
      </div>
    </div>

    <div class="row text-center bg-dark">
      <div class="col-sm mb-2">
        <a class="text-light" href="https://www.lillemetropole.fr/challengevelo" target="_blank" rel="noopener noreferrer">En savoir plus sur le challenge vélo  (site de la MEL)</a>
      </div>
      <div class="col-sm">
        <a class="text-light" href="https://challengevelo.lillemetropole.fr/" target="_blank" rel="noopener noreferrer">Accéder aux classements complets</a>
      </div>
    </div>
  </div>

  <script>
  function setNewValue(target, currentValue, newValue, formatter)
  {
    /// We can now start animating things
    $(target).prop('Counter', currentValue).animate({
      Counter: newValue
    },
    {
      duration: 1000,
      easing: 'swing',
      step: function (value)
      {
        $(this).text(formatter(value));
      }
    }
  );
} /// End of setNewValue

totalKm = 0
numberFormatter = new Intl.NumberFormat('fr-FR');
load()

function load()
{
  $.ajax({
    url: "https://www.naviki.org/naviki/api/v5/Contest/2/findContest/51090",
    dataType: "json",
    cache : false,
    success: function(json)
    {
      totalKm = json.totalKmInsideBoundary
      setNewValue( $("#totalKm"), 0, totalKm, function(value){ return numberFormatter.format(Math.ceil(value)) })
    }
  });

  $.ajax({
    url: "https://www.naviki.org/naviki/api/v5/Contest/findTeams/51090/?offset=0&limit=500",
    dataType: "json",
    cache : false,
    success: function(json)
    {
      teams = {}
      numberOfMembers = 0
      for( i in json.teams )
      {
        teams[json.teams[i]["name"]] = json.teams[i]
        numberOfMembers += parseInt(json.teams[i]["numberOfMembers"])
      }

      ulilleteams = {
        "roule pour santes" : "rps",
        "Santes, ma ville" : "smv",
      }

      totalKmLille = 0.0
      numberOfMembersLille = 0
      for( name in ulilleteams )
      {
        if( name in teams )
        {
          totalKmLille += parseFloat(teams[name]["totalKmInsideBoundary"])
          numberOfMembersLille += parseInt(teams[name]["numberOfMembers"])
          $("#"+ulilleteams[name]).html( teams[name]["numberOfMembers"] + " inscrits, " + teams[name]["totalKmInsideBoundary"] + " Km" )
        }
      }
      $("#spinner").addClass("d-none")
      $("#line1").removeClass("d-none")

      setNewValue( $("#totalKm-lille"), 0, totalKmLille, function(value){ return numberFormatter.format(Math.ceil(value)) })
      setNewValue( $("#numberOfMembers-lille"), 0, numberOfMembersLille, function(value){ return numberFormatter.format(Math.ceil(value)) })
      setNewValue( $("#numberOfTeams-lille"), 0, Object.keys(ulilleteams).length, function(value){ return numberFormatter.format(Math.ceil(value)) })

      setNewValue( $("#totalKm"), 0, totalKm, function(value){ return numberFormatter.format(Math.ceil(value)) })
      setNewValue( $("#numberOfMembers"), 0, numberOfMembers, function(value){ return numberFormatter.format(Math.ceil(value)) })
      setNewValue( $("#numberOfTeams"), 0, json.teams.length, function(value){ return numberFormatter.format(Math.ceil(value)) })
    } /// End of callback
  });
}
</script>


</body>
</html>
